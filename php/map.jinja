# -*- coding: utf-8 -*-
# vim: ft=jinja

{%- if salt['pillar.get']('php:use_external_repo', False) %}
    {%- import_yaml "php/defaults.extrepo.yaml" as osfinger_extdefaults %}
        {%- set php = salt['grains.filter_by']({
            'Debian': {
                'build_pkgs': ['autoconf', 'build-essential', 'gcc', 'libc-dev', 'libcurl4-openssl-dev', 'libssl-dev', 'libsslcommon2-dev', 'make', 'pkg-config'],
                'composer_bin': 'composer',
                'local_bin': '/usr/local/bin',
                'suhosin5_ext': 'suhosin.so',
                'suhosin5_repo': 'https://github.com/sektioneins/suhosin',
                'suhosin7_ext': 'suhosin7.so',
                'suhosin7_repo': 'https://github.com/sektioneins/suhosin7',
                'temp_dir': '/tmp',
            },
            'RedHat': {
                'build_pkgs': ['openssl-devel', 'gcc'],
                'composer_bin': 'composer',
                'local_bin': '/usr/local/bin',
                'suhosin5_ext': 'suhosin.so',
                'suhosin5_repo': 'https://github.com/sektioneins/suhosin',
                'suhosin7_ext': 'suhosin7.so',
                'suhosin7_repo': 'https://github.com/sektioneins/suhosin7',
                'temp_dir': '/tmp',
            },
        }, merge=salt['grains.filter_by'](
            osfinger_extdefaults
        , grain='osfinger', merge=salt['pillar.get']('php:lookup'))) %}
{%- else  %}
    {%- import_yaml "php/defaults.yaml" as osfinger_defaults %}
        {%- set php = salt['grains.filter_by']({
            'Debian': {
                'build_pkgs': ['autoconf', 'build-essential', 'gcc', 'libc-dev', 'libcurl4-openssl-dev', 'libssl-dev', 'libsslcommon2-dev', 'make', 'pkg-config'],
                'composer_bin': 'composer',
                'local_bin': '/usr/local/bin',
                'suhosin5_ext': 'suhosin.so',
                'suhosin5_repo': 'https://github.com/sektioneins/suhosin',
                'suhosin7_ext': 'suhosin7.so',
                'suhosin7_repo': 'https://github.com/sektioneins/suhosin7',
                'temp_dir': '/tmp',
            },
            'RedHat': {
                'build_pkgs': ['openssl-devel', 'gcc'],
                'composer_bin': 'composer',
                'local_bin': '/usr/local/bin',
                'suhosin5_ext': 'suhosin.so',
                'suhosin5_repo': 'https://github.com/sektioneins/suhosin',
                'suhosin7_ext': 'suhosin7.so',
                'suhosin7_repo': 'https://github.com/sektioneins/suhosin7',
                'temp_dir': '/tmp',
            },
            'Suse': {
                'adodb_pkg': 'php5-dba',
                'cli_pkg': 'php5-cli',
                'composer_bin': 'composer',
                'curl_pkg': 'php5-curl',
                'dev_pkg': 'php5-devel',
                'ext_conf_path': '/etc/php5/conf.d',
                'fpm_pkg': 'php5-fpm',
                'fpm_service': 'php5-fpm',
                'gd_pkg': 'php5-gd',
                'imap_pkg': 'php5-imap',
                'intl_pkg': 'php5-intl',
                'json_pkg': 'php5-json',
                'ldap_pkg': 'php5-ldap',
                'local_bin': '/usr/local/bin',
                'mbstring_pkg': 'php5-mbstring',
                'mcrypt_pkg': 'php5-mcrypt',
                'mongo_ext': 'mongo.so',
                'mongo_pecl': 'mongo',
                'mysql_pkg': 'php5-mysql',
                'pear_pkg': 'php5-pear',
                'pgsql_pkg': 'php5-pgsql',
                'php_ini': '/etc/php5/apache2/php.ini',
                'php_pkg': 'php5',
                'readline_pkg': ' php5-readline',
                'soap_pkg': 'php5-soap',
                'sqlite_pkg': 'php5-sqlite',
                'suhosin5_ext': 'suhosin.so',
                'suhosin5_repo': 'https://github.com/sektioneins/suhosin',
                'suhosin7_ext': 'suhosin7.so',
                'suhosin7_repo': 'https://github.com/sektioneins/suhosin7',
                'temp_dir': '/tmp',
                'xml_pkg': ['php5-xmlreader','php5-xmlwriter','php5-xmlrpc'],
                'zip_pkg': 'php5-zip',
            },
        }, merge=salt['grains.filter_by'](
            osfinger_defaults
        , grain='osfinger', merge=salt['pillar.get']('php:lookup'))) %}
{%- endif %}
